âœ… ëª©í‘œ ê°œìˆ˜ ì¶©ì¡± ì „ê¹Œì§€ ë°˜ë³µí•´ì„œ ë°ì´í„° ìˆ˜ì§‘
âœ… CSV íŒŒì¼ë¡œ ë°ì´í„° ì €ì¥ (ìë™ ëˆ„ì )
âœ… ê° ë™ì‘ë³„ ë°ì´í„° ê°œìˆ˜ ì‹¤ì‹œê°„ í‘œì‹œ
âœ… ëª©í‘œ ë„ë‹¬ ì‹œ ë°ì´í„° ìˆ˜ì§‘ ìë™ ì¢…ë£Œ

------------------------------------

import serial
import time
import binascii

PORT = "COM9"  # í¬íŠ¸ í™•ì¸ í›„ ìˆ˜ì •
BAUD_RATE = 57600  # ğŸ›  9600ì—ì„œ 57600ìœ¼ë¡œ ë³€ê²½ (ë” ë¹ ë¥´ê³  ì•ˆì •ì )

def extract_brainwaves(packet):
    """ThinkGear íŒ¨í‚·ì—ì„œ ë² íƒ€íŒŒì™€ ê°ë§ˆíŒŒë§Œ ì •í™•íˆ ì¶”ì¶œ"""
    beta_low, beta_high = None, None
    gamma_low, gamma_high = None, None

    try:
        index = 0
        while index < len(packet):
            code = packet[index:index+2]  # ë°ì´í„° ìœ í˜• ì½”ë“œ (Hex 2ìë¦¬)
            if code in ["06", "07", "08", "09"]:  # Beta Low, Beta High, Gamma Low, Gamma High
                value_hex = packet[index+2:index+8]  # 3ë°”ì´íŠ¸(6ìë¦¬ 16ì§„ìˆ˜)
                
                # ğŸ›  3ë°”ì´íŠ¸ ë°ì´í„°ë¥¼ 10ì§„ìˆ˜ë¡œ ë³€í™˜
                try:
                    value = int(value_hex, 16)
                    value = value & 0xFFFFFF  # 24ë¹„íŠ¸ ë§ˆìŠ¤í‚¹

                    # ğŸ›  ì´ìƒê°’ í•„í„°ë§ (ì •ìƒì ì¸ ë²”ìœ„: 0~10000)
                    if value > 10000:
                        value = None  # ë¹„ì •ìƒì ì¸ ê°’ ì œê±°
                except ValueError:
                    value = None  # ë³€í™˜ ì˜¤ë¥˜ ë°©ì§€

                if code == "06":
                    beta_low = value
                elif code == "07":
                    beta_high = value
                elif code == "08":
                    gamma_low = value
                elif code == "09":
                    gamma_high = value

                index += 8  # 2(ì½”ë“œ) + 6(ë°ì´í„°) ì´ë™
            else:
                index += 2  # ë‹¤ìŒ ì½”ë“œë¡œ ì´ë™

    except Exception as e:
        print(f"ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜: {e}")

    return beta_low, beta_high, gamma_low, gamma_high

def read_neuro_data():
    try:
        ser = serial.Serial(PORT, BAUD_RATE, timeout=1)
        print(f"âœ… ì‹œë¦¬ì–¼ í¬íŠ¸ {PORT} ì—°ê²°ë¨, ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘...")

        buffer = b""

        # ğŸ›  ë°ì´í„°ê°€ ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ë„ë¡ ì¶”ê°€
        while ser.in_waiting == 0:
            print("â³ ë°ì´í„° ìˆ˜ì‹  ëŒ€ê¸° ì¤‘...")
            time.sleep(0.5)

        while True:
            if ser.in_waiting > 0:
                raw_data = ser.read(64)  # 64ë°”ì´íŠ¸ì”© ì½ê¸° (íŒ¨í‚· ê¸¸ì´ ëŒ€ë¹„ ì¦ê°€)
                buffer += raw_data

                hex_data = binascii.hexlify(buffer).decode('utf-8')

                if "aaaa" in hex_data:
                    start_index = hex_data.index("aaaa")
                    packet_data = hex_data[start_index:]

                    if len(packet_data) > 6:
                        try:
                            length = int(packet_data[4:6], 16)
                        except ValueError:
                            length = 0  # ë³€í™˜ ì˜¤ë¥˜ ë°©ì§€

                        if len(packet_data) >= (6 + length * 2):
                            valid_packet = packet_data[:(6 + length * 2)]

                            beta_low, beta_high, gamma_low, gamma_high = extract_brainwaves(valid_packet)

                            # ğŸ“Œ ê°’ì´ ì •ìƒ ë²”ìœ„(0~10000) ë‚´ì— ìˆëŠ” ê²½ìš°ë§Œ ì¶œë ¥
                            if beta_low is not None or beta_high is not None or gamma_low is not None or gamma_high is not None:
                                print(f"ğŸ§  ë² íƒ€íŒŒ (Low): {beta_low}, ë² íƒ€íŒŒ (High): {beta_high}")
                                print(f"âš¡ ê°ë§ˆíŒŒ (Low): {gamma_low}, ê°ë§ˆíŒŒ (High): {gamma_high}")

                            buffer = buffer[start_index + 2:]

                else:
                    print("âŒ ìœ íš¨í•œ ë°ì´í„° íŒ¨í„´(aaaa) ì—†ìŒ, ë‹¤ì‹œ ìˆ˜ì‹  ì¤‘...")
                    time.sleep(0.1)  # ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ë‹¤ì‹œ ì‹œë„

            time.sleep(0.05)

    except serial.SerialException:
        print(f"âŒ ì˜¤ë¥˜: í¬íŠ¸ '{PORT}'ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í¬íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!")
    except Exception as e:
        print(f"ì˜¤ë¥˜ ë°œìƒ: {e}")
    finally:
        if 'ser' in locals():
            ser.close()
            print("ğŸ”Œ ì‹œë¦¬ì–¼ í¬íŠ¸ ì¢…ë£Œë¨.")

# ì‹¤í–‰
read_neuro_data()


---------------------------------------

ğŸ“Š ì‹¤í–‰ ì˜ˆì‹œ

ğŸ§  ë‡ŒíŒŒ ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘! (ëª©í‘œ: ê° ë™ì‘ 50ê°œ)

[í˜„ì¬ ë°ì´í„° ê°œìˆ˜]
âœ… ì™¼ìª½: 12/50
âœ… ì˜¤ë¥¸ìª½: 15/50
âœ… ìœ„ë¡œ: 10/50
âœ… ì•„ë˜ë¡œ: 18/50
âœ… ì •ì§€: 20/50

ë¡œë´‡íŒ” ë™ì‘ ì…ë ¥ (ì™¼ìª½/ì˜¤ë¥¸ìª½/ìœ„ë¡œ/ì•„ë˜ë¡œ/ì •ì§€): ìœ„ë¡œ
âœ… ë°ì´í„° ì €ì¥: 512, 820, 435, 1234 â†’ ìœ„ë¡œ

[í˜„ì¬ ë°ì´í„° ê°œìˆ˜]
âœ… ì™¼ìª½: 12/50
âœ… ì˜¤ë¥¸ìª½: 15/50
âœ… ìœ„ë¡œ: 11/50
âœ… ì•„ë˜ë¡œ: 18/50
âœ… ì •ì§€: 20/50

ğŸ‰ ëª©í‘œ ê°œìˆ˜ ë„ë‹¬! ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ.
--------------------------------
