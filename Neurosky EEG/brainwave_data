âœ… ëª©í‘œ ê°œìˆ˜ ì¶©ì¡± ì „ê¹Œì§€ ë°˜ë³µí•´ì„œ ë°ì´í„° ìˆ˜ì§‘
âœ… CSV íŒŒì¼ë¡œ ë°ì´í„° ì €ì¥ (ìë™ ëˆ„ì )
âœ… ê° ë™ì‘ë³„ ë°ì´í„° ê°œìˆ˜ ì‹¤ì‹œê°„ í‘œì‹œ
âœ… ëª©í‘œ ë„ë‹¬ ì‹œ ë°ì´í„° ìˆ˜ì§‘ ìë™ ì¢…ë£Œ

------------------------------------

import csv
import time
import serial
import binascii
from collections import defaultdict

PORT = "COM9"  # ë‡ŒíŒŒ ì„¼ì„œ ì—°ê²°ëœ í¬íŠ¸
BAUD_RATE = 57600
TARGET_COUNT = 50  # ê° ë™ì‘ë‹¹ ìµœì†Œ 50ê°œ ëª©í‘œ

# ë°ì´í„° ê°œìˆ˜ ì¹´ìš´íŠ¸
data_counts = defaultdict(int)

# CSV íŒŒì¼ í™•ì¸ ë° ê¸°ì¡´ ë°ì´í„° ê°œìˆ˜ ì²´í¬
file_path = "brainwave_data.csv"

try:
    with open(file_path, "r") as file:
        reader = csv.reader(file)
        next(reader)  # í—¤ë” ê±´ë„ˆë›°ê¸°
        for row in reader:
            if len(row) == 5:
                data_counts[row[4]] += 1
except FileNotFoundError:
    pass  # íŒŒì¼ì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±

# CSV íŒŒì¼ ì—´ê¸° (ì“°ê¸° ëª¨ë“œ)
with open(file_path, "a", newline="") as file:
    writer = csv.writer(file)
    
    # íŒŒì¼ì´ ì—†ì—ˆìœ¼ë©´ í—¤ë” ì¶”ê°€
    if not data_counts:
        writer.writerow(["Beta Low", "Beta High", "Gamma Low", "Gamma High", "Action"])

def check_completion():
    """ëª¨ë“  ë™ì‘ì´ ëª©í‘œ ê°œìˆ˜(TARGET_COUNT)ì— ë„ë‹¬í–ˆëŠ”ì§€ í™•ì¸"""
    return all(count >= TARGET_COUNT for count in data_counts.values())

def read_neuro_data():
    try:
        ser = serial.Serial(PORT, BAUD_RATE, timeout=1)
        print(f"ğŸ§  ë‡ŒíŒŒ ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘! (ëª©í‘œ: ê° ë™ì‘ {TARGET_COUNT}ê°œ)")

        while not check_completion():  # ëª©í‘œ ê°œìˆ˜ ë„ë‹¬ ì „ê¹Œì§€ ê³„ì† ë°˜ë³µ
            if ser.in_waiting > 0:
                raw_data = ser.read(64)
                hex_data = binascii.hexlify(raw_data).decode('utf-8')

                if "aaaa" in hex_data:
                    beta_low, beta_high, gamma_low, gamma_high = extract_brainwaves(hex_data)
                    
                    # ê°’ì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜ì§‘ëœ ê²½ìš°ë§Œ ì €ì¥
                    if beta_low and beta_high and gamma_low and gamma_high:
                        print("\n[í˜„ì¬ ë°ì´í„° ê°œìˆ˜]")
                        for action, count in data_counts.items():
                            print(f"âœ… {action}: {count}/{TARGET_COUNT}")

                        action = input("ë¡œë´‡íŒ” ë™ì‘ ì…ë ¥ (ì™¼ìª½/ì˜¤ë¥¸ìª½/ìœ„ë¡œ/ì•„ë˜ë¡œ/ì •ì§€): ")

                        # ìœ íš¨í•œ ë™ì‘ì¸ì§€ í™•ì¸í•˜ê³  ê¸°ë¡
                        if action in ["ì™¼ìª½", "ì˜¤ë¥¸ìª½", "ìœ„ë¡œ", "ì•„ë˜ë¡œ", "ì •ì§€"]:
                            data_counts[action] += 1
                            writer.writerow([beta_low, beta_high, gamma_low, gamma_high, action])
                            print(f"âœ… ë°ì´í„° ì €ì¥: {beta_low}, {beta_high}, {gamma_low}, {gamma_high} â†’ {action}")
                        else:
                            print("âŒ ì˜¬ë°”ë¥¸ ë™ì‘ì„ ì…ë ¥í•˜ì„¸ìš”!")

            time.sleep(0.05)

        print("\nğŸ‰ ëª©í‘œ ê°œìˆ˜ ë„ë‹¬! ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ.")
    except Exception as e:
        print(f"ì˜¤ë¥˜ ë°œìƒ: {e}")
    finally:
        ser.close()
        print("ì‹œë¦¬ì–¼ í¬íŠ¸ ì¢…ë£Œë¨.")

read_neuro_data()


---------------------------------------

ğŸ“Š ì‹¤í–‰ ì˜ˆì‹œ

ğŸ§  ë‡ŒíŒŒ ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘! (ëª©í‘œ: ê° ë™ì‘ 50ê°œ)

[í˜„ì¬ ë°ì´í„° ê°œìˆ˜]
âœ… ì™¼ìª½: 12/50
âœ… ì˜¤ë¥¸ìª½: 15/50
âœ… ìœ„ë¡œ: 10/50
âœ… ì•„ë˜ë¡œ: 18/50
âœ… ì •ì§€: 20/50

ë¡œë´‡íŒ” ë™ì‘ ì…ë ¥ (ì™¼ìª½/ì˜¤ë¥¸ìª½/ìœ„ë¡œ/ì•„ë˜ë¡œ/ì •ì§€): ìœ„ë¡œ
âœ… ë°ì´í„° ì €ì¥: 512, 820, 435, 1234 â†’ ìœ„ë¡œ

[í˜„ì¬ ë°ì´í„° ê°œìˆ˜]
âœ… ì™¼ìª½: 12/50
âœ… ì˜¤ë¥¸ìª½: 15/50
âœ… ìœ„ë¡œ: 11/50
âœ… ì•„ë˜ë¡œ: 18/50
âœ… ì •ì§€: 20/50

ğŸ‰ ëª©í‘œ ê°œìˆ˜ ë„ë‹¬! ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ.
--------------------------------
