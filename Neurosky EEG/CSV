pip install pyserial pandas
-------------------------


import serial
import time
import binascii

PORT = "COM9"  # í¬íŠ¸ í™•ì¸ í›„ ìˆ˜ì •
BAUD_RATE = 9600

def extract_brainwaves(packet):
    """ThinkGear íŒ¨í‚·ì—ì„œ ë² íƒ€íŒŒì™€ ê°ë§ˆíŒŒë§Œ ì •í™•íˆ ì¶”ì¶œ"""
    beta_low, beta_high = None, None
    gamma_low, gamma_high = None, None

    try:
        index = 0
        while index < len(packet):
            code = packet[index:index+2]  # ë°ì´í„° ìœ í˜• ì½”ë“œ (Hex 2ìë¦¬)
            if code in ["06", "07", "08", "09"]:  # Beta Low, Beta High, Gamma Low, Gamma High
                value_hex = packet[index+2:index+8]  # 3ë°”ì´íŠ¸(6ìë¦¬ 16ì§„ìˆ˜)
                
                # ğŸ›  3ë°”ì´íŠ¸ ë°ì´í„°ë¥¼ 10ì§„ìˆ˜ë¡œ ë³€í™˜
                value = int(value_hex, 16)

                # ğŸ›  ThinkGear ë°ì´í„°ëŠ” 3ë°”ì´íŠ¸(24ë¹„íŠ¸)ì´ë¯€ë¡œ, ìƒìœ„ 8ë¹„íŠ¸ê°€ ì˜ëª»ë˜ì—ˆì„ ìˆ˜ ìˆìŒ â†’ í•˜ìœ„ 3ë°”ì´íŠ¸ë§Œ ì‚¬ìš©
                value = value & 0xFFFFFF  # 24ë¹„íŠ¸ ë§ˆìŠ¤í‚¹

                # ğŸ›  ì´ìƒê°’ í•„í„°ë§ (ì •ìƒì ì¸ ë²”ìœ„: 0~10000)
                if value > 10000:
                    value = None  # ë¹„ì •ìƒì ì¸ ê°’ ì œê±°

                if code == "06":
                    beta_low = value
                elif code == "07":
                    beta_high = value
                elif code == "08":
                    gamma_low = value
                elif code == "09":
                    gamma_high = value

                index += 8  # 2(ì½”ë“œ) + 6(ë°ì´í„°) ì´ë™
            else:
                index += 2  # ë‹¤ìŒ ì½”ë“œë¡œ ì´ë™

    except Exception as e:
        print(f"ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜: {e}")

    return beta_low, beta_high, gamma_low, gamma_high

def read_neuro_data():
    try:
        ser = serial.Serial(PORT, BAUD_RATE, timeout=1)
        print(f"ì‹œë¦¬ì–¼ í¬íŠ¸ {PORT} ì—°ê²°ë¨, ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘...")

        buffer = b""

        while True:
            if ser.in_waiting > 0:
                raw_data = ser.read(64)  # 64ë°”ì´íŠ¸ì”© ì½ê¸° (íŒ¨í‚· ê¸¸ì´ ëŒ€ë¹„ ì¦ê°€)
                buffer += raw_data

                hex_data = binascii.hexlify(buffer).decode('utf-8')

                if "aaaa" in hex_data:
                    start_index = hex_data.index("aaaa")
                    packet_data = hex_data[start_index:]

                    if len(packet_data) > 6:
                        length = int(packet_data[4:6], 16)

                        if len(packet_data) >= (6 + length * 2):
                            valid_packet = packet_data[:(6 + length * 2)]

                            beta_low, beta_high, gamma_low, gamma_high = extract_brainwaves(valid_packet)

                            # ğŸ“Œ ê°’ì´ ì •ìƒ ë²”ìœ„(0~10000) ë‚´ì— ìˆëŠ” ê²½ìš°ë§Œ ì¶œë ¥
                            if beta_low is not None or beta_high is not None or gamma_low is not None or gamma_high is not None:
                                print(f"ğŸ§  ë² íƒ€íŒŒ (Low): {beta_low}, ë² íƒ€íŒŒ (High): {beta_high}")
                                print(f"âš¡ ê°ë§ˆíŒŒ (Low): {gamma_low}, ê°ë§ˆíŒŒ (High): {gamma_high}")

                            buffer = buffer[start_index + 2:]

                time.sleep(0.05)

    except Exception as e:
        print(f"ì˜¤ë¥˜ ë°œìƒ: {e}")
    finally:
        ser.close()
        print("ì‹œë¦¬ì–¼ í¬íŠ¸ ì¢…ë£Œë¨.")

# ì‹¤í–‰
read_neuro_data()

-------------------------
python sscom_logger.py
