중앙에서 “지속 스캔 전용”으로 바로 확인

트리거 없이 계속 스캔만 하는 간단 스크립트를 하나 만듭니다.
/home/codestudio/COS/central_scan.py

#!/usr/bin/env python3
from bluepy.btle import Scanner
import time

def parse_service_data_hex(hexstr):
    try:
        b = bytes.fromhex(hexstr)
        if len(b) < 2: return None
        if b[0:2] != b'\xff\xff':  # UUID 0xFFFF
            return None
        payload = b[2:]
        if not payload: return None
        tag = payload[0]  # b'C' or b'P'
        if tag not in (0x43, 0x50):  # 'C', 'P'
            return None
        info = {"tag": chr(tag)}
        if len(payload) >= 4:
            uid3 = payload[1:4]
            info["uid3"] = uid3.hex().upper()
        return info
    except:
        return None

def main():
    scanner = Scanner()
    print("[scan] start (ServiceData 0xFFFF: 'C'(beacon) / 'P'(ACK))")
    while True:
        devs = scanner.scan(3.0)
        hits = []
        for d in devs:
            for (adtype, desc, value) in d.getScanData():
                if adtype == 0x16:  # Service Data (16-bit)
                    p = parse_service_data_hex(value)
                    if p:
                        hits.append((d.addr, d.rssi, p))
        if hits:
            print(f"[scan] hits {len(hits)}:")
            for mac, rssi, p in hits:
                tag = p.get("tag", "?")
                uid = p.get("uid3", "???")
                print(f"  - {tag}  UID3={uid}  RSSI={rssi}  MAC={mac}")
        else:
            print("[scan] no hits")
        time.sleep(0.5)

if __name__ == "__main__":
    main()

----------------------
실행:

sudo /home/codestudio/bleenv/bin/python /home/codestudio/COS/central_scan.py


피코가 디버그 비콘(C) 을 내므로, 1~2초 안에 아래처럼 떠야 합니다:

[scan] hits 2:
  - C  UID3=12AB34  RSSI=-55  MAC=xx:xx:xx:...
  - C  UID3=56CD78  RSSI=-62  MAC=yy:yy:yy:...


여기서 C 는 “디버그 비콘”, P 는 “ACK” 입니다.
지금은 C만 떠도 정상. 이게 확인되면 이후 트리거-ACK 로직도 살아있다는 뜻입니다.
